<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<script type='text/javascript' src='../knockout-2.2.1.js'></script>
<style>
.tablerow:hover td {
	background-color:#ccc;
}
</style>
</head>
<body>

<input data-bind='value: searchField, valueUpdate: "afterkeydown", event:{keypress:acceptItem}'/>
<table>
<thead><tr data-bind='foreach:listColumns'><th><span data-bind='text:caption, click: makeSort'></span><span data-bind='visible:sort()=="asc"'>▲</span><span data-bind='visible:sort()=="desc"'>▼</span></th></thead>
<tbody data-bind="foreach:listItems">
<tr class=tablerow data-bind="click: $parent.chooseItem"><td data-bind="text: code"><td data-bind="text: name"><td data-bind="text: surname"></tr>
</tbody>
</table>
<script>
	var headers = ['Код','Имя','Фамилия'];
	var maindata = [
	{
		name:'Владимир',surname:'Третьяк',code:'КЛ01001'
	},
	{
		name:'Владимир',surname:'Иванов',code:'КЛ01002'
	},
	{
		name:'Александр',surname:'Треногин',code:'КЛ01003'
	},
	{
		name:'Андрей',surname:'Саламатин',code:'КЛ01004'
	},
	{
		name:'Екатерина',surname:'Селивёрстова',code:'КЛ02001'
	},
	{
		name:'Александр',surname:'Селивёрстов',code:'КЛ01005'
	}
	]

	function ChooseListModel() {
		// Data
		var self = this;
		self.searchField = ko.observable("");
		self.listItems = ko.computed(function() {
			var filtered = [];
			for (var i = 0; i < maindata.length; i++) {
				for(var j in maindata[i]) {
					if(maindata[i][j].indexOf(self.searchField())==0) {
						filtered.push(maindata[i]);//фильтрация по всем полям
						break;
					}
				}
			}
			return filtered;
		}).extend({ throttle: 500 });//задержка вычисления мс
		self.listColumns = ko.computed(function() {
			var columns = [];
			for (var i = 0; i < headers.length; i++) {
				columns.push({caption:headers[i],sort:ko.observable(''),makeSort:function(item) {if(!item.sort()) item.sort("asc"); else if(item.sort()=="asc") item.sort("desc"); else if(item.sort()=="desc") item.sort("");}} );
			}
			return columns;
		});
		
		//Behavior
		self.chooseItem = function(item) {
			self.searchField(item.code);
		}
		self.acceptItem = function(data,event) {
			if(event.keyCode == 13 && self.listItems().length == 1) {
				self.searchField(self.listItems()[0].code);
			}
			return true;//для действия по умолчанию
		}
		/*
		self.shouldShow = function(item) {
			return item.surname.indexOf(self.searchField())==0 || item.name.indexOf(self.searchField())==0;
		}
		*/
	}
	ko.applyBindings(new ChooseListModel());
</script>
</body>
</html>